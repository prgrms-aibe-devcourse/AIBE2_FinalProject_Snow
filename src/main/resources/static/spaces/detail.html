<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>공간 상세</title>
    <link rel="stylesheet" href="/css/template-adapter.css"/>
    <style>
        .detail-wrap{max-width:960px;margin:20px auto;padding:16px;background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.06)}
        .hero{width:100%;height:320px;border-radius:12px;object-fit:cover;background:#f3f4f6}
        .title{font-size:22px;font-weight:700;margin:16px 0 8px}
        .meta{color:#555;line-height:1.8}
        .btn-row{margin-top:16px;display:flex;gap:10px}
    </style>
</head>
<body>
<main class="detail-wrap">
    <img id="hero" class="hero" alt="cover"/>
    <h1 id="title" class="title"></h1>
    <div class="meta">
        <div><b>등록자 :</b> <span id="ownerName"></span></div>
        <div><b>면적 :</b> <span id="areaSize"></span>㎡</div>
        <div><b>임대료 :</b> 하루 <span id="rentalFee"></span> 만 원</div>
        <div><b>주소 :</b> <span id="address"></span></div>
        <div><b>기간 :</b> <span id="period"></span></div>
        <div style="margin-top:8px;white-space:pre-wrap"><b>상세 설명</b><br/><span id="description"></span></div>
    </div>
    <div class="btn-row">
        <button onclick="history.back()">목록으로</button>
        <button onclick="inquire(spaceId)">문의하기</button>
        <button onclick="reportSpace(spaceId)">신고</button>
    </div>
</main>

<script>
    let spaceId = null;

    document.addEventListener('DOMContentLoaded', async () => {
        const p = new URLSearchParams(location.search);
        spaceId = p.get('id');
        if(!spaceId){ alert('잘못된 접근'); location.href='/spaces/list'; return; }

        const res = await fetch(`/api/spaces/${spaceId}`);
        if(!res.ok){ alert('상세 불러오기 실패'); history.back(); return; }
        const s = await res.json();

        document.getElementById('hero').src = s.coverImageUrl || '/images/placeholder.png';
        document.getElementById('title').textContent = s.title ?? '(제목 없음)';
        document.getElementById('ownerName').textContent = (s.ownerName || s.owner?.name) ?? '-';
        document.getElementById('areaSize').textContent = s.areaSize ?? '-';
        document.getElementById('rentalFee').textContent = (s.rentalFee||0).toLocaleString('ko-KR');
        document.getElementById('address').textContent = s.address ?? '-';
        document.getElementById('description').textContent = s.description ?? '-';
        const sd = (s.startDate||'').toString().slice(0,10);
        const ed = (s.endDate||'').toString().slice(0,10);
        document.getElementById('period').textContent = `${sd} ~ ${ed}`;
    });

    // list.html에서 쓴 것 재사용
    async function inquire(id){
        try{
            const res = await fetch(`/api/spaces/${id}/inquiries`, {method:'POST'});
            alert(res.ok ? '문의 요청이 접수되었습니다.' : '문의 요청 실패');
        }catch(e){ alert('문의 중 오류'); }
    }
    async function reportSpace(id){
        try{
            const res = await fetch(`/api/spaces/${id}/reports`, {method:'POST'});
            alert(res.ok ? '신고가 접수되었습니다.' : '신고 실패');
        }catch(e){ alert('신고 중 오류'); }
    }
</script>
</body>
</html>
